---
title: 'ブログ移行-Mizuki設定記録'
published: 2026-02-22
updated: 2026-02-23
description: 'notionNext から Mizuki への移行プロセスを記録。Mizuki を選択した理由は、その柔軟性と軽量化にある。設定過程でコンテンツ管理の方法に着目し、API を用いてユーザーデータを取得し、CI を通じてnotion内容をリアルタイムに同期させ、複数言語対応をサポートする。全体的な設定方針は、コンテンツ出力の流暢さを向上させることを目的とする。'
image: 'https://r2.dreaife.tokyo/notion/covers/30f5465cca1780cc8df8e7c367a16f3d/IMG_4450.jpg'
tags: ['blog', 'llm', 'deploy', 'notion']
category: 'infra'
draft: false
lang: 'ja'
---

2026/02/22、記録

今日はNotionNextからMizukiへ移行した。

====

なぜmizukiに切り替えるのかというと、NotionNextの制約があまりにも厳しすぎるからです。現代のVibe Codingの発展を考えると、もう少し自由に調整したいという気持ちがあります。

実は最初はHexoやinneiを試してみようと思っていましたが、たまたまmizukiの動画に出会い、まずは試してみようと思いました。機能は決して重くなく、個人とプロジェクトのバランスにも適していると感じました。

それでは、Notionをブログのストレージとして使用してmizukiへ移行したときの私の記録の概略です。

# Mizukiのデプロイ

MizukiはAstroをベースに開発されたブログフレームワークです。正直なところ、以前WordPress/Hexo/NotionNextのような自前デプロイのブログをいくつか作ってきましたが、外観を大まかに見てテーマが良さそうなら乗り換えるつもりでした。もちろん今回も例外ではありません（

今回切り替えを選んだ主な理由は、Mizukiには日記機能があり、軽い愚痴を吐くニーズを満たすことができ、またプロジェクトを紹介する場所もあることです。Astroはやはり汎用的なテーマなので、雰囲気を出したい場合の素材は比較的豊富だろう。というわけで移行しました（で、地雷に遭遇しました（笑））。

## Mizukiの設定

大まかな設定自体は特に難しくなく、[公式ドキュメント](https://docs.mizuki.mysqil.com/)に従って設定すればOKです。

大体注意すべき点は、postとaboutの内容はmdを修正して制御するのに対し、日記（日記／日誌／dairy）、プロジェクト、タイムラインといった他のコンテンツはts内のdataを修正して制御するという点です。

さらに面白い点として、bangumiのAPI `/v0/users/{userId}/collections` に接続してユーザーの番組記録を取得できます。取得タイプを少し変更し、Bangumiのトークンを設定すれば、エロゲのコレクションリストを表示できるようになります。そしてアニメのページを少しだけ変更すれば、エロゲの記録ページが新しく出来上がります（地雷を踏むような展開）。

## 個人設定

次に、個人設定について。CIを使ってNotionの内容をMizukiへリアルタイム同期させる予定なので、Mizukiは[ブログの内容と構成を分離して記述する](https://docs.mizuki.mysqil.com/Other/separation/)ことをサポートしており、コンテンツのリポジトリでいじるのがちょうど良い機会でした。構造をシンプルに変更するのもかなり楽です。

大筋としては、2点です。CIを通じてNotionの執筆内容を同期させることと、Notion同期済みの記事のLLMによる事前処理を通じて多言語対応を実現することです。

### Notionの内容をCIで同期する

実際には cron 的な定期実行をして Notion の更新状況を定期的に取得するだけですが、Notion APIの通信速度を考えると、2日も走らせてGitHub Actionsのクォータを使い切ってしまいそうなので、この同期アクションは自己ホスト上で実行することにしました。

具体的な実装は特に難しくなく、Notionのデータベース内容を取り出し、post/about/dairy のような種類の異なるコンテンツを1つの type に振り分け、Notionデータベースの column と上記コンテンツの具体的な設定を対応させる、という流れです。そうして自然に処理がまとまります（雰囲気を出す程度に）。

ただし小さな落とし穴があります。Notionのヘッダ画像リンクのいくつかは実際には1時間で有効期限が切れるURLです（Notionが使用している画像ストレージは実はAWS S3で、R2の方が容量が多いのでは、という気がします）。したがって外部ストレージに持続可能な形で保存しておく必要があります（実際にはR2で十分です）。ただNotionに画像を追加する際に直接URLを使用すると、取得される画像リンクは上記のもののままです。したがって事前に画像を更新しておけば、大した問題にはなりません。

具体的な実装はおおよそ以下を参照してください：
[NotionSyncAction](https://github.com/dreaite/Mizuki-Content/blob/notionUpdateSync/.github/notion-sync/README.md)（mizuki-GitHubのリポジトリをどう活用できるかを試すにはぴったりです（

::github{repo="dreaite/Mizuki-Content/blob/notionUpdateSync/.github/notion-sync/README.md"}

### LLМによる多言語適応

実際にはNotion同期CIの前に、Mizukiのフレームワーク部分も少し変更が必要でした。現状はブラウザ言語に追従して表示言語を切り替える機能はまだないため、.en.md/.ja.md のような拡張子のファイルを多言語対応に取り込むよう、少しだけ変更しました。元々静的サイトを前提としているため、多言語UIを多く表示するには大掛かりな変更が必要になる場合があります。とはいえこの種の多言語切替の実装はさまざまなプロジェクトで既に多くありますので、雰囲気だけかいつまんで説明します。

::github{repo="dreaifekks/Mizuki"}

次にCIにLLM翻訳モジュールを追加します。

だいたい同じで、汎用的な翻訳プロンプトに、簡単なAPI呼び出しを組み合わせるだけです。ただし、長い文章のLLMの応答時間は長くなることがあるため、実際のリクエストのタイムアウト時間を少し調整する必要があります。

[LLM部分の実装](https://github.com/dreaite/Mizuki-Content/blob/feat(i18n)/llm-translate/.github/notion-sync/README.md)

::github{repo="dreaite/Mizuki-Content"}

# 結語

だいたいこれくらいです。深い変更はあまりないので、個人の設定方針を大まかに述べておきます。

現在CIを設定し終えたので、出力のフローを少しスムーズにできたと言えるでしょう（
